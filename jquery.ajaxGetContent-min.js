/**

 *	jQuery AjaxGetContent 1.6

 *
 *
 *	Requires: jQuery BBQ, http://benalman.com/projects/jquery-bbq-plugin/
 *	
 *	Copyright (c) 2012 Implico Group
 *	www.implico.pl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	
 *	@author Bartosz Sak <info@implico.pl>
 *
 *	More info at:
 *	@see http://www.implico.pl/en/ajaxgetcontent-dynamic-ajax-website,7
 *	
 */


!function(t){t.fn.ajaxGetContent=function(e){if(options=t.extend(!0,{requestParameter:"ajax_get_standard_content",baseUrl:"",useCache:!0,forceBookmarkLinking:!1,params:{},excludeAttr:{rel:"lightbox",rel:"nofollow"},onHrefCheck:function(t,e){return(t.length>0||e.length>0)&&(t.indexOf(".")<0||".html"==t.substr(t.length-5,5)||".php"==t.substr(t.length-4,4))},onElementCheck:function(t){return!t.hasClass("no-ajax-load")},formsGet:{'form[method="get"]':function(){return!0}},formsPost:null,effect:{type:null,target:"body",insertHead:!1,insertTitle:!0,timeoutBefore:300,timeoutAfter:300,callbackBeforePreAnimation:null,callbackBeforePostAnimation:null,callbackAfterPreAnimation:null,callbackAfterPostAnimation:null,loadScripts:!0},onSend:function(){t.fn.ajaxGetContent.lastClickedElement&&t.fn.ajaxGetContent.scrollTo(0,!0,options.effect.timeoutBefore),t.fn.ajaxGetContent.animationDeferred&&(t.fn.ajaxGetContent.animationDeferred.cancelled=!0,options.effect.target.stop("ajaxGetContent")),options.effect.callbackBeforePreAnimation&&options.effect.callbackBeforePreAnimation(),t.fn.ajaxGetContent.animationDeferred=new t.Deferred(function(e){e.cancelled=!1;var n;"fade"==options.effect.type?(n=options.effect.target.stop("ajaxGetContent").animate({opacity:.2},{duration:options.effect.timeoutBefore,queue:"ajaxGetContent"}).promise(),options.effect.target.dequeue("ajaxGetContent")):n=(new t.Deferred).resolve(),t.when(n).then(function(){e.cancelled?e.reject():(e.resolve(),options.effect.callbackBeforePostAnimation&&options.effect.callbackBeforePostAnimation())})})},onReceive:function(e,n){t.when(t.fn.ajaxGetContent.animationDeferred).then(function(){if(e="success"==n?e:e.responseText){if((options.effect.insertHead||options.effect.insertTitle)&&(dataHead=e.replace(/\<\!doctype[.\s\S]*\<head((\s[^\>]*\>)|(\>))/im,"").replace(/\<\/head\>[.\s\S]*/,""),dataHead))if(options.effect.insertHead)t("head").html(dataHead);else{var a=/\<title\>([^\<]*)/.exec(dataHead);a[1]&&t("head title").text(a[1])}e=e.replace(/\<\!doctype[.\s\S]*\<\/head\>/im,"").replace(/\<\/html\>/im,"").replace(/\<body[^\>]*\>/im,"").replace(/\<\/body\>/im,""),e=e,e=t(t.parseHTML(e,document,options.effect.loadScripts));var o=t("body");o.data("ajaxGetContent",null),o.html(e),options.effect.loadScripts||t("a").ajaxGetContent(options),window._gaq&&_gaq.push(["_trackPageview",t.fn.ajaxGetContent.getCurrentUrl()]),options.effect.callbackAfterPreAnimation&&options.effect.callbackAfterPreAnimation(),t.fn.ajaxGetContent.animationDeferred=new t.Deferred(function(e){e.cancelled=!1;var n;"fade"==options.effect.type?(n=options.effect.target.stop("ajaxGetContent").animate({opacity:1},{duration:options.effect.timeoutAfter,queue:"ajaxGetContent"}).promise(),options.effect.target.dequeue("ajaxGetContent")):n=(new t.Deferred).resolve(),t.when(n).then(function(){e.cancelled?e.reject():e.resolve()})}),t.fn.ajaxGetContent.animationDeferred.done(function(){t.fn.ajaxGetContent.animationDeferred=null,options.effect.callbackAfterPostAnimation&&options.effect.callbackAfterPostAnimation()})}})}},e),(e.formsGet||null===e.formsGet)&&(options.formsGet=e.formsGet),(e.formsPost||null===e.formsPost)&&(options.formsPost=e.formsPost),"object"!=typeof options.effect.target&&(options.effect.target=t(options.effect.target)),!t("body").data("ajaxGetContent")){var n=navigator.userAgent.toLowerCase().indexOf("android")>-1;t.fn.ajaxGetContent.usePushState=Boolean(!options.forceBookmarkLinking&&history.pushState&&!n)}t("body").data("ajaxGetContent")||(t.fn.ajaxGetContent.cache=new Array);t.fn.ajaxGetContent.lastClickedElement=null,t.fn.ajaxGetContent.lastClickedUrl=null,t.fn.ajaxGetContent.ajaxHandler=null,t.fn.ajaxGetContent.history=t.fn.ajaxGetContent.history||[],t.fn.ajaxGetContent.animationDeferred=t.fn.ajaxGetContent.animationDeferred||null,wasLoaded=!0;var a=function(e,n,o){if("boolean"==typeof e){if(t.fn.ajaxGetContent.ajaxHandler&&(t.fn.ajaxGetContent.ajaxHandler.abort(),t.fn.ajaxGetContent.ajaxHandler=null),t.fn.ajaxGetContent.lastClickedUrl=n,t.fn.ajaxGetContent.lastUrl=t.fn.ajaxGetContent.getCurrentUrl(),t.fn.ajaxGetContent.lastFullUrl=t.fn.ajaxGetContent.getCurrentUrl(!0),options.useCache&&n in t.fn.ajaxGetContent.cache)return options.onSend(n),void a(t.fn.ajaxGetContent.cache[n],"success",!0);var r=new Array,i=(new String,n),f=t.fn.ajaxGetContent.lastClickedElement,s=f&&f.data("options")?f.data("options"):options;t.each(s.params,function(e,n){f.is(e)&&t.each(n,function(t,e){r.push({name:t,value:e})})}),options.onSend(n),options.requestParameter&&r.push({name:options.requestParameter,value:"on"}),t.fn.ajaxGetContent.ajaxHandler=t.ajax({url:i,data:r,type:"GET",success:a,error:a,context:this}),t.fn.ajaxGetContent.history.push(n)}else t.fn.ajaxGetContent.ajaxHandler=null,"success"==n&&options.useCache&&t.fn.ajaxGetContent.lastClickedUrl&&(t.fn.ajaxGetContent.cache[t.fn.ajaxGetContent.lastClickedUrl]=e),options.onReceive(e,n,1==o)};t.fn.ajaxGetContent.load=function(e){t.fn.ajaxGetContent.usePushState?(null==e&&(e=location.href),history.pushState({},"",e),t(window).trigger("popstate")):(null==e&&(e=t.param.fragment()),t.param.fragment()!=e?jQuery.bbq.pushState(e,2):a(!0,e))},t.fn.ajaxGetContent.scrollTo=function(e,n,a){"undefined"==typeof a&&(a=500);var o=t("html").scrollTop();o||(o=t("body").scrollTop());var r="number"==typeof e;(n||o>(r?e:t(e).offset().top))&&t("html,body").stop().animate({scrollTop:r?e:t(e).offset().top},a)},t.fn.ajaxGetContent.getCurrentUrl=function(e,n){var a="";if(t.fn.ajaxGetContent.usePushState){if(a=new String(location.href),!e){var o=a.indexOf("//");o=o>=0?o+2:0,a=a.substr(a.indexOf("/",o)),0==a.length&&(a="/")}}else a=t.param.fragment();return n||(a=-1==a.indexOf("#")?a:a.substr(0,a.indexOf("#"))),a},t.fn.ajaxGetContent.clearCache=function(){t.fn.ajaxGetContent.cache=new Array};var o=function(){t(window).bind(t.fn.ajaxGetContent.usePushState?"popstate":"hashchange",function(){var e=null,n=!1;t.fn.ajaxGetContent.usePushState?(e=t.fn.ajaxGetContent.getCurrentUrl(!0,!0),t.fn.ajaxGetContent.lastFullUrl&&e.indexOf("#")>=0&&(n=t.fn.ajaxGetContent.getCurrentUrl(!0)==t.fn.ajaxGetContent.lastFullUrl)):(e=t.fn.ajaxGetContent.getCurrentUrl(),urlCheck=e,urlCheck.indexOf("?")>=0&&(urlCheck=urlCheck.substr(0,urlCheck.indexOf("?"))),n=!(""==urlCheck||options.onHrefCheck(urlCheck))),n||(!t.fn.ajaxGetContent.usePushState||wasLoaded)&&a(!0,e)}),t("body").data("ajaxGetContent",!0)};t("body").data("ajaxGetContent")||o(),t(window).load(function(){wasLoaded=!1,setTimeout(function(){wasLoaded=!0,t.fn.ajaxGetContent.usePushState||""==t.param.fragment()||t(window).trigger("hashchange"),t.fn.ajaxGetContent.lastUrl||(t.fn.ajaxGetContent.lastUrl=t.fn.ajaxGetContent.getCurrentUrl(),t.fn.ajaxGetContent.lastFullUrl=t.fn.ajaxGetContent.getCurrentUrl(!0))},1)});var r=function(e){var n=location.href;if(!e&&!t.fn.ajaxGetContent.usePushState){var a=n.indexOf("#");if(a>=0){n=n.substr(a);var o=n.indexOf("?");o>=0&&(n=n.substr(0,o)),e=n}}return e};return null!=options.formsGet&&t.each(options.formsGet,function(e,n){t(e).each(function(e,a){if(a=t(a),a.data("ajaxGetContent"))return!0;var o=function(e,n,a){return function(){return n&&!n.call(e)?!1:a&&!a.call(e)?!1:(t.fn.ajaxGetContent.lastClickedElement=t(e),t.fn.ajaxGetContent.load(r(t(e).attr("action"))+"?"+t(e).serialize().replace("%5B%5D","[]")),!1)}},i=a.get(0).onsubmit;a.get(0).onsubmit=null,a.submit(o(this,i,n)),a.data("ajaxGetContent",!0)})}),null!=options.formsPost&&t.each(options.formsPost,function(e,n){t(e).each(function(e,a){if(a=t(a),a.data("ajaxGetContent"))return!0;var o=function(e,n,a){return function(){if("undefined"!=typeof CKEDITOR)for(var o in CKEDITOR.instances)CKEDITOR.instances[o].updateElement();var i=t(e);if(n&&!n.call(e))return!1;if(a.onSend&&!a.onSend.call(e))return!1;i.find(".submit-clicked-append").remove();var f=i.find(".agc-submit-clicked");f.length||(f=i.find('input[type="submit"], button[type="submit"]').first()),f.length&&i.append(t('<input type="hidden" name="'+f.attr("name")+'" value="'+f.attr("value")+'" class="submit-clicked-append" style="display:none !important;" />')),t.fn.ajaxGetContent.lastClickedElement=i;var s=a.onReceive?a.onReceive:function(){};return t.ajax({url:r(i.attr("action")),data:i.serializeArray(),type:"POST",success:s,error:s,context:e}),!1}},i=a.get(0).onsubmit;a.get(0).onsubmit=null,a.find('input[type="submit"], button[type="submit"]').click(function(){t(this).parents("form").find('input[type="submit"], button[type="submit"]').removeClass("agc-submit-clicked"),t(this).addClass("agc-submit-clicked")}),a.submit(o(a.get(0),i,n)),a.data("ajaxGetContent",!0)})}),this.each(function(e,n){$this=t(n);var a=$this.data("ajaxGetContent"),o=$this.attr("href");if(!o)return!0;var r=new String,i="http:"!=location.href.substr(0,5),f=new String((i?"https://":"http://")+window.location.hostname);0==o.indexOf(f)&&(o=o.substr(f.length)),o.indexOf("?")>=0&&(r=o.substr(o.indexOf("?")),o=o.substr(0,o.indexOf("?")));var s=$this.attr("target"),l=o.indexOf("#")>=0||"undefined"!=typeof s&&s!==!1,c=options.onHrefCheck(o,r),u=options.onElementCheck($this),d=!1;t.each(options.excludeAttr,function(t,e){return $this.attr(t)&&0==$this.attr(t).indexOf(e)?void(d=!0):void 0});var p=null!=$this.get(0).onclick;a||l||!c||!u||d||p||($this.data("ajaxGetContent",!0),$this.click(function(e){var n=t(this);if(o=t(this).attr("href"),!options.onHrefCheck(o,r))return!0;if(!options.onElementCheck(n))return!0;if(e&&e.which&&1!=e.which)return!0;var a=new String(window.location.href);if(a.indexOf("#")>=0&&(a=a.substr(0,a.indexOf("#"))),!t.fn.ajaxGetContent.usePushState){var i=options.baseUrl;if(""!=i&&a!=i)return location.href=i+"#"+o+r,!1}return n.data("options",options),t.fn.ajaxGetContent.lastClickedElement=n,t.fn.ajaxGetContent.load(o+r),!1}))})}}(jQuery);


/*
 * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(e,t){"$:nomunge";function N(e){return typeof e==="string"}function C(e){var t=r.call(arguments,1);return function(){return e.apply(this,t.concat(r.call(arguments)))}}function k(e){return e.replace(/^[^#]*#?(.*)$/,"$1")}function L(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function A(r,o,a,f,l){var c,h,p,d,g;if(f!==n){p=a.match(r?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);g=p[3]||"";if(l===2&&N(f)){h=f.replace(r?S:E,"")}else{d=u(p[2]);f=N(f)?u[r?m:v](f):f;h=l===2?f:l===1?e.extend({},f,d):e.extend({},d,f);h=s(h);if(r){h=h.replace(x,i)}}c=p[1]+(r?"#":h||!p[1]?"?":"")+h+g}else{c=o(a!==n?a:t[y][b])}return c}function O(e,t,r){if(t===n||typeof t==="boolean"){r=t;t=s[e?m:v]()}else{t=N(t)?t.replace(e?S:E,""):t}return u(t,r)}function M(t,r,i,o){if(!N(i)&&typeof i!=="object"){o=i;i=r;r=n}return this.each(function(){var n=e(this),u=r||h()[(this.nodeName||"").toLowerCase()]||"",a=u&&n.attr(u)||"";n.attr(u,s[t](a,i,o))})}var n,r=Array.prototype.slice,i=decodeURIComponent,s=e.param,o,u,a,f=e.bbq=e.bbq||{},l,c,h,p=e.event.special,d="hashchange",v="querystring",m="fragment",g="elemUrlAttr",y="location",b="href",w="src",E=/^.*\?|#.*$/g,S=/^.*\#/,x,T={};s[v]=C(A,0,L);s[m]=o=C(A,1,k);o.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);x=new RegExp(n.join("|"),"g")};o.noEscape(",/");e.deparam=u=function(t,r){var s={},o={"true":!0,"false":!1,"null":null};e.each(t.replace(/\+/g," ").split("&"),function(t,u){var a=u.split("="),f=i(a[0]),l,c=s,h=0,p=f.split("]["),d=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[d])){p[d]=p[d].replace(/\]$/,"");p=p.shift().split("[").concat(p);d=p.length-1}else{d=0}if(a.length===2){l=i(a[1]);if(r){l=l&&!isNaN(l)?+l:l==="undefined"?n:o[l]!==n?o[l]:l}if(d){for(;h<=d;h++){f=p[h]===""?c.length:p[h];c=c[f]=h<d?c[f]||(p[h+1]&&isNaN(p[h+1])?{}:[]):l}}else{if(e.isArray(s[f])){s[f].push(l)}else if(s[f]!==n){s[f]=[s[f],l]}else{s[f]=l}}}else if(f){s[f]=r?n:""}});return s};u[v]=C(O,0);u[m]=a=C(O,1);e[g]||(e[g]=function(t){return e.extend(T,t)})({a:b,base:b,iframe:w,img:w,input:w,form:"action",link:b,script:w});h=e[g];e.fn[v]=C(M,v);e.fn[m]=C(M,m);f.pushState=l=function(e,r){if(N(e)&&/^#/.test(e)&&r===n){r=2}var i=e!==n,s=o(t[y][b],i?e:{},i?r:2);t[y][b]=s+(/#/.test(s)?"":"#")};f.getState=c=function(e,t){return e===n||typeof e==="boolean"?a(e):a(t)[e]};f.removeState=function(t){var r={};if(t!==n){r=c();e.each(e.isArray(t)?t:arguments,function(e,t){delete r[t]})}l(r,2)};p[d]=e.extend(p[d],{add:function(t){function i(e){var t=e[m]=o();e.getState=function(e,r){return e===n||typeof e==="boolean"?u(t,e):u(t,r)[e]};r.apply(this,arguments)}var r;if(e.isFunction(t)){r=t;return i}else{r=t.handler;t.handler=i}}})})(jQuery,this);(function(e,t,n){"$:nomunge";function c(e){e=e||t[s][u];return e.replace(/^[^#]*#?(.*)$/,"$1")}var r,i=e.event.special,s="location",o="hashchange",u="href",a=document.documentMode,f=navigator.appVersion.indexOf("MSIE")!=-1&&parseFloat(navigator.appVersion.split("MSIE")[1])<8,l="on"+o in t&&!f;e[o+"Delay"]=100;i[o]=e.extend(i[o],{setup:function(){if(l){return false}e(r.start)},teardown:function(){if(l){return false}e(r.stop)}});r=function(){function h(){a=l=function(e){return e};if(f){i=e('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;l=function(){return c(i.document[s][u])};a=function(e,t){if(e!==t){var n=i.document;n.open().close();n[s].hash="#"+e}};a(c())}}var n={},r,i,a,l;n.start=function(){if(r){return}var n=c();a||h();(function i(){var f=c(),h=l(n);if(f!==n){a(n=f,h);e(t).trigger(o)}else if(h!==n){t[s][u]=t[s][u].replace(/#.*/,"")+"#"+h}r=setTimeout(i,e[o+"Delay"])})()};n.stop=function(){if(!i){r&&clearTimeout(r);r=0}};return n}()})(jQuery,this)
